想要了解Android平台架构，那么就避免不了一张图片，作为安卓开发都必须见过的一张图片，如下

![Android架构图](https://github.com/MickeyQiong/ANote/blob/main/picture/android-stack_2x.png)

Android是一种基于Linux的开放源代码软件栈，为各类设备和机型而创建。下面我们来解析一下上面图片中的组件。

## Linux Kernel（Linux 内核）

`Android平台的基础是Linux内核。`比如ART虚拟机最终调用底层Linux内核来执行功能。Linux内核的安全机制为Android提供相应的保障，也允许设备制造商为内核开发硬件驱动程序。

## HAL（硬件抽象层）

硬件抽象层提供标准界面，向更高级别的Java API 框架显示设备硬件功能。HAL 包含多个库模块，其中每个模块都为特定类型的硬件组件实现一个界面，例如相机或蓝牙模块。当框架 API 要求访问设备硬件时，Android 系统将为该硬件组件加载库模块。

## Android Runtime

对于运行 Android 5.0（API 级别 21）或更高版本的设备，每个应用都在其自己的进程中运行，并且有其自己的 Android Runtime (ART)实例。ART 编写为通过执行 DEX 文件在低内存设备上运行多个虚拟机，DEX 文件是一种专为 Android 设计的字节码格式，经过优化，使用的内存很少。编译工具链将 Java 源代码编译为 DEX 字节码，使其可在 Android 平台上运行。

ART 的部分主要功能包括：

- 预先 (AOT) 和即时 (JIT) 编译
- 优化的垃圾回收 (GC)
- 在Android9（API级别28）及更高版本的系统中，支持将软件包中的DEX文件转换为更紧凑的机器代码。
- 更好的调试支持，包括专用采样分析器、详细的诊断异常和崩溃报告，并且能够设置观察点以监控特定字段。

**在Android版本5.0之前，Dalvik是Android Runtime。**

## 原生C/C++库

许多核心Android系统组件和服务（例如ART和HAL）构建自原生代码，需要以C和C++编写的原生库。Android平台提供调用native层功能的Java framework API。

举个例子，我们的app可以访问OpenGL ES通过Android 底层的Java OpenGL API 来支持绘制2D和3D图形。

如果要开发需要C或C++代码的应用程序，则可以使用Android NDK直接从本机代码访问某些本机平台库。

## Java API框架

通过使用Java语言编写的API，就可以使用Android OS的整个功能集。这些API通过简化核心，模块化系统组件和服务的重用，构成了创建Android应用所需的构建块，其中包括：

* 丰富并且可扩展的视图系统，可用于构建应用程序的UI，包括列表、网格、文本框、按钮，甚至是可嵌入的Web浏览器。
* 一个资源管理器，提供对非编码资源，如本地字符串、图形和布局文件。
* 一个通知管理器，使所有应用程序都能在状态栏中显示自定义的报警
* 一个Activity管理器，用于管理应用程序的生命周期并提供通用的回退栈。
* ContentProvider使应用程序能够访问其他应用程序中的数据或共享自己的数据，例如联系人应用程序

## 系统应用

Android附带了一组用于电子邮件，SMS消息传递，日历，互联网浏览，联系人等的核心应用程序。平台附带的应用程序在用户选择安装的应用程序是没有没有什么不同的。因此，第三方应用程序可以成为用户的默认Web浏览器，SMS Messenger甚至是默认键盘。但是有一些除外，比如系统的设置。

系统应用程序既充当用户的应用程序，又提供开发人员可以从自己的应用程序访问的关键功能。例如如果你的应用程序希望传递SMS消息，则你无需自己构建该功能，只需调用已安装的任何SMS应用程序将消息传递给你制定的收件人。